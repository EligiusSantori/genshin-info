<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Artifacts enchantment helper</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap-reboot.min.css" integrity="sha256-fjdlYyQyUwnf7m25DM18I325nnS2LbN7gdHPrq+OCyc=" crossorigin="anonymous" />
	<link rel="stylesheet" href="css/enchant.css" />
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/mathjs@14.6.0/lib/browser/math.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/ractive@1.4.4/ractive.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/textile-js@2.1.1/lib/textile.min.js"></script>
	<script src="js/formula.js"></script>
	<script defer src="js/index.js"></script>
	<script defer src="js/ruleset.js"></script>
	<script defer src="js/ruleset/default.js"></script>
	<script defer src="js/enchant.js"></script>
</head>
<body>
	<div id="content"></div>
	<script id="layout" type="text/ractive">
		<nav>
			<section class="sets radio-panel">
			{{#each sets: i}}
				<label class="radio-image"><input type="radio" name="{{artifact.set}}" value="{{name}}" /><img src="{{image}}" alt="{{name}}" /></label>
				{{#if i == sets.length / 2 - 1}}<div  class="flex-break"></div>{{/if}}
			{{/each}}
			</section>
		</nav>
		<hr class="flex-break" />
		<aside class="summary">
		{{#if !@global._.isEmpty(summary)}}
			<table>
				<tr><th colspan="2">Summary</th></tr>
				{{#with summary.rolls}}<tr><th>Rolls</th><td>{{.}}</td></tr>{{/with}}
				{{#with summary.rules}}<tr><th>Rules</th><td>{{.}}</td></tr>{{/with}}
				{{#with summary.forecasts}}<tr><th>Variants</th><td>{{.}}</td></tr>{{/with}}
			</table>
		{{/if}}
		</aside>
		<article>
			<table id="artifact" class="verdict-{{ @this.verdictAsClass(verdict, 'error', 'unclaimed', 'promising') }}">
				<tr class="level-row">
					<th colspan="3">Level<span class="note" tooltip="For 3-stat artifacts use level ‚â• 4 since v6.0">ùê¢</span></th>
					<td>{{artifact.level}}</td>
					<td colspan="2"><input type="range" min="0" max="20" step="4" value="{{artifact.level}}" /></td>
				</tr>
				<tr class="column-row">
					<td rowspan="9">
						<div class="radio-panel">
							<label class="radio-icon"><input type="radio" name="{{artifact.slot}}" value="0" />
								<img alt="Flower" src="images/Icon_Flower_of_Life.png" /><br /></label>
							<label class="radio-icon"><input type="radio" name="{{artifact.slot}}" value="1" />
								<img alt="Plume" src="images/Icon_Plume_of_Death.png" /></label>
							<label class="radio-icon"><input type="radio" name="{{artifact.slot}}" value="2" />
								<img alt="Sands" src="images/Icon_Sands_of_Eon.png" /></label>
							<label class="radio-icon"><input type="radio" name="{{artifact.slot}}" value="3" />
								<img alt="Goblet" src="images/Icon_Goblet_of_Eonothem.png" /></label>
							<label class="radio-icon"><input type="radio" name="{{artifact.slot}}" value="4" />
								<img alt="Circlet" src="images/Icon_Circlet_of_Logos.png" /></label>
						</div>
					</td>
					<td rowspan="9">
						<div class="radio-panel">
						{{#each affixes: name}}
							<label class="radio-pane"><input type="radio" name="{{artifact.affix}}" value="{{name}}" />{{.}}</label>
						{{/each}}
						</div>
					</td>
				</tr>
				{{#each stats: stat}}
				<tr class="stat-row {{name == artifact.affix && 'disabled'}}">
					<th>{{title}}</th>
					<td><input type="number" min="{{min}}" max="{{max}}" step="{{step}}" value="{{artifact[stat]}}"
						disabled="{{stat == artifact.affix}}" on-input="['rangeSet', stat]" /></td>
					<td class="slider"><input type="range" min="{{min}}" max="{{max}}" step="{{step}}" value="0" twoway="0"
						disabled="{{stat == artifact.affix}}" on-input="['statChange', stat]" /></td>
					<td class="coeff">√ó{{ @this.fraction(@global._.get(coeffs, stat, coeffs.bd)) }}</td>
				</tr>
				{{/each}}
				<tr class="quality-row">
					<th colspan="2">
						Quality
						{{#with quality}}<span class="note" tooltip="{{ @global.formula.render(quality) }}">ùê¢</span>{{/with}}
					</th>
					<td colspan="2"><button tabindex="-1" on-click="clear">
						{{{ quality ? @global.formula.evaluate(quality) : '&nbsp;' }}}
					</button></td>
				</tr>
			</table>
		</article>
		<aside class="display">
			<table class="messages">
			{{#if artifact && messages.length > 0}}
				<tr>
					<th></th>
				{{#each @this.filled(4)}}
					<td>{{.}}</td>
				{{/each}}
				</tr>
			{{/if}}
			{{#each messages}}
				<tr class="{{type}}">
					<th colspan="{{type == 'error' ? 5 : 1}}">
						{{{@global.textile(text)}}}
						{{#with formula}}<span class="note" tooltip="{{.}}">ùê¢</span>{{/with}}
					</th>
				{{#each artifact ? artifact.toDisplay() : []}}
					<td>{{.}}</td>
				{{/each}}
				</tr>
			{{/each}}
			</table>
		</aside>
		{{#if @this.constructor.DEBUG}}
		<samp class="debug" style="bottom: 0.33em; right: 0.5em;">{{ JSON.stringify(artifact.valid()) }}</samp>
		{{/if}}
	</script>
	<script type="text/javascript">
		//Ractive.DEBUG = /unminified/.test(function(){/*unminified*/})
		Ractive.DEBUG = window.location.protocol.startsWith('file:');
		window.onload = function() { ready('#content', '#layout'); }
	</script>
</body>
</html>
