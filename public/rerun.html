<!doctype html>

<html lang="en">
	<head>
	<meta charset="utf-8">
	<title>Characters rerun retentions.</title>
	<meta name="description" content="Genshin Impact characters rerun retentions.">
	<meta name="author" content="MirrorImage">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap-reboot.min.css" integrity="sha256-fjdlYyQyUwnf7m25DM18I325nnS2LbN7gdHPrq+OCyc=" crossorigin="anonymous">
	<!-- <link rel="stylesheet" href="css/index.css"> -->
	<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/ractive"></script>
	<script defer="defer" src="js/index.js"></script>
	<style>
		:root {
			--grade4-color: rgba(154,112,175,1);
			--grade5-color: rgba(193,117,33,1);
			--grade4-st-color: rgba(154,112,175,0.7);
			--grade5-st-color: rgba(193,117,33,0.7);
		}
		html, body, #content, table { height: 100%; padding: 0; margin: 0; }
		table { width: 100%; table-layout: fixed; font-size: x-small; }
		caption { display: none; }
		th, td {
			border: 1px #777 solid;
			padding: 0;
			text-align: center;
			vertical-align: middle;
			line-height: 1.5;
		}
		tr:first-of-type th:first-child { width: 10em; }
		tr[data-grade="4"] { background-color: var(--grade4-st-color); }
		tr[data-grade="5"] { background-color: var(--grade5-st-color); }
		tr[data-grade="4"] th { background-color: var(--grade4-color); }
		tr[data-grade="5"] th { background-color: var(--grade5-color); }
		td.now { background-color: #66cc33; }
		tbody tr:hover th, tbody tr:hover td:not(.now) { background-color: #dd9 !important; }
		.value { border-radius: 1em; line-height: 1; color: #555; margin: 0 0.5em; }
	</style>
</head>

<body>
	<article id="content"></article>
	<script id="layout" type="text/ractive">
		<table>
			<caption>{{caption}}</caption>
			<colgroup><col />{{#each banners}}<col />{{/each}}</colgroup>
			<thead>
				<tr>
					<th rowspan="2">&nbsp;</th>
					{{#each years}}
					<th colspan="{{.}}">{{@key}}</th>
					{{/each}}
				</tr>
				<tr>
					{{#each banners: i}}
					<th>{{start.toISOString().match(/\d{4}-(\d{2})-(\d{2})/).slice(1,3).join('-')}}</th>
					{{/each}}
				</tr>
			</thead>
			<tbody>
				{{#each data as r: i}}
					{{#unless excluded.includes(characters[i].name)}}
					<tr data-grade="{{characters[i].grade}}">
						<th>{{characters[i].name}}</th>
						{{#each r as v: j}}
							{{#if v}}
							<td style="background-color: rgba(204, 0, 0, {{v/100*5}})">{{{ v > 0 ? v : '&nbsp;' }}}</td>
							{{else}}
							<td class-now="(v == 0)"></td>
							{{/if}}
						{{/each}}
					</tr>
					{{/unless}}
				{{/each}}
			</tbody>
		</table>
	</script>
	<script type="text/javascript">
		window.onload = function() {
			let table = new Array(db.characters.length);
			for(let i = 0; i < table.length; i++) {
				let row = new Array(db.banners.length);
				for(let j = 0, d = undefined; j < row.length; j++) {
					d = db.banners[j].characters.includes(db.characters[i].name) ? 0 : d + 1;
					row[j] = d;
				}
				table[i] = row;
			}

			let years = {};
			db.banners.forEach(function(b) {
				let y = b.start.getFullYear();
				years[y] ? years[y]++ : years[y] = 1;
			});

			var ractive = new Ractive({
				target: '#content',
				template: '#layout',
				data: {
					excluded: ["Aloy", "Jean", "Mona", "Qiqi", "Diluc", "Keqing", "Amber", "Kaeya", "Lisa"],
					characters: db.characters,
					banners: db.banners,
					years: years,
					data: table,
					filter: _.filter,
				},
			});
		}
	</script>
</body>
</html>
